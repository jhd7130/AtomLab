## #1. TCP 통신시 MAC주소의 변환
**TCP 통신시 발생 상황**  
HDD에서 가져온 정보를 Process 레벨의 Buffer 메모리에 쌓는다.(64KB 정도) -> 이게 Socket Stream 데이터가 되고 TCP에서 자신의 Buffer에 Stream 데이터가 쌓인 Buffer 복사 -> Buffer에 담겨있는 데이터를 Segment 단위로 Segmentation -> IP로 Segment를 하나씩 보내면 IP에서 IP 헤더를 추가해 Packet 생성 -> 생성된 packet을 -> Frame에 담아서 internet(조금 더 자세하게는 라우터로 보냄--시작 라우터는 GateWay로 사용하는 라우터)으로 보내게된다.  
  
이렇게 일련의 과정이 이뤄지고 나서부터는 packet을 전달하면서 목적지에 도달한다. 이동의 과정에서 이 이더넷 헤더가 라우터(L2구간의 스위칭)를 통과할때마다 변경된다. 변경되는 데이터는 출발지 MAC주소와 목적지MAC 주소이다.  
  
**하나의 서버에서 다른 서버로 데이터를 보낼때의 Frame에 생기는 변화**  
L3에서 Packet이 생성되고 이더넷 헤더가 붙어 Frame에 담기면 이더넷 헤더에 출발지는 현재 PC주소 목적지는 자신이 속해있는 네트워크의 GateWay Router 주소가 된다.  
-> Router에 도달하면 이더넷 헤더가 분리되고 현재 Router와 목적지 Router의 주소가 추가된 이더넷 헤더가 붙어 새로운 Frame을 생성하여 다음 라우터로 전송된다.  
-> 목적지 서버가 속한 GateWay Router에 도달하면 다음 목적지는 목적지 호스트의 주소가 이더넷 헤더에 추가되어 호스트에게 전달된다  

## #2. L2스위치와 ARP
L2스위치 기본적으로 우리가 알고 있는 L2스위치는 아래와 같이 생겼다.    
<img width="412" alt="스크린샷 2022-06-29 오후 12 55 21" src="https://user-images.githubusercontent.com/78134917/176348084-c62fdb64-1dcc-4f26-b82f-7c8afd234a7d.png">  
  
하나의 홀을 인터페이스 또는 Port라고 말한다. 위의 그림의 스위치를 5포트 스위치 허브라고 부른다. 이 포트는 자신과 연결될 PC의 MAC주소를 기억하고 있는다. 어떻게 기억하는지 한번 보자. L2 스위치가 부팅되면 학습모드로 들어간다. 1번 포트와 연결된 A PC가 이더넷 프레임을 5번 포트에 연결된 B PC에 전송하면 이때 처음으로 ' 아 내가 A PC랑 연결되있구나 MAC 주소 저장해야지!'하면서 해당 주소를 기억한다. 맨처음 전송을 시도하면 B PC의 MAC 주소를 가진 포트가 어디있는지 모르기 때문에 모든 포트를 찔러본다.  
  
일반적으로 하나의 포트에 하나의 MAC주소만 할당할 수 있을 것 같지만 그렇지 않다. L2 스위치의 성능을 평가하는 요소에는 포트 하나당 몇개의 MAC주소가 저장가능한지도 있다. 이유는 아래와 같다. 
계층형 L2 스위치 구성하고 있는 경우에 하나의 포트에 여러개의 MAC주소를 저장할 필요가 있다. 예를 들어 A L2 스위치의 1번 포트에 B L2 스위치가 연결되어 있고 5대의 PC가 연결되어 있다. A L2 스위치를 통과해 다른 포트에 연결된 PC와 연결하려면 A L2 스위치가 가진 하나의 포트에는 MAC 주소를 여러개 가지고있어야한다.  
  
### ARP(Adress Resolution Protocol : 주소 결정 프로토콜)  
IP 주소로 MAC 주소를 찾는 방식(반대의 과정을 RARP라고 부른다.)  
목적지 주소를 알아서 TCP/IP헤더를 만들때 해당 주소를 작성하고 Packet을 만들었다. 하지만 물리적 주소를 모르기 때문에 정확한 유니캐스트를 통한 통신이 불가능하다. 이럴 경우 LAN으로 연결된 모든 호스트에게 Broad Cast 방식으로 전송한다. 목적지 IP 주소가 아닌 호스트들은 응답을 하지 않고 목적지 주소를 가진 호스트가 응답에 자신의 물리적 MAC주소를 유니캐스트를 통해 반송한다. 이게 ARP이다.  
