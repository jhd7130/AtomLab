## #1. Cache란?  
일단 Cache는 컴퓨터가 데이터를 기억하기 위해 사용하는 저장공간 중 하나이다. CPU가 빠른 연산을 위해 RAM에서 필요한 데이터들을 미리 저장하고 사용한다. MB단위로 저장된다.  
간단하게 CS의 관점에서 Cache에 대해 알아보았다. 
  
소프트웨어관점에서 Cache는 자주사용하는 데이터의 빠른 조회를 위해 Disk(DB)에서 꺼내와 미리 저장하는 공간이다. 주로 사용된다. 하드디스크와는 다르게 Cache 메모리는 인메모리인 RAM Memory를 사용한다. Cache가 사용하는 RAM 메모리는 하드디스크와는 다르게 많은 양의 저장공간을 제공하지 않는다. 그래서 하드디스크에 비해 저장공간이 비싸지만 빠르다.   
   
하지만 이 캐시는 무작정 사용할 수 있는 것은 아니다. 다음과 같은 조건이 성립될 때 캐시를 고려해볼 수 있다.  
- 반복적으로 동일한 결과를 돌려주는 작업  
- 각 작업의 시간이 오래 걸리거나 서버에 부담을 주는 경우 (외부 API/DB 데이터호출 등)  

위에서 처럼 캐시에는 자주 사용(Hitting율이 높은)하거나 작업의 시간이 오래걸리는 데이터들에 대해 캐시를 고려해볼 수 있다. 조회하는 데이터가 캐시에 있을 경우 Cache Hit라고 이야기한다. 하지만 조회하는 데이터가 없을 경우 Cache Miss라고 이야기한다.  
  
한가지 집고 넘어갈 것이 있다. 인메모리 DB,캐시시템에서 사용하는 메모리는 Cache Memory가 아니고 RAM memory다. 데이터를 조회할때 디스크에 접근하여 데이터를 조회해오는 것이 아니고 RAM으로 접근하여 조회하기 때문에 빠르다. RAM메모리를 Cache메모리처럼 사용하여 Cache 시스템이라고 부르는 것 같다.   
  
이 Cache는 DB와의 동시성 문제를 가장 신경 써야한다. 

## #2. Cache의 종류   
Local Cache, Global Cache, Web Cache, CDN(캐시의 한종류)
- Local Cache.(EHcache)  
어플리케이션이 작동하는 메모리에서 사용되는 캐시를 말한다.   
**Local Cache**의 경우에는 Local 장치에 있기 때문에 빠를 수 밖에 없다.(같은 장치를 사용한다. 같은 Memory나 Disk를 사용한다) 하지만 이 Cache의 데이터가 유실되면 대처할 방법이 없다. 또하나의  단점이 있다. 서버가 다중화될 경우 동기화를 어떻게 시켜줄 것인가이다. 하나의 서버의 캐시 데이터가 변경되었다. 그럼 다른 서버에 있는 캐시 데이터에게 통보를 해줘야하는데 이걸 어떻게 잘 맞춰줘야하는데 힘들다.  
- Global Cache.(Redis, MemCached 등)  
그래서 **Global Cache**라는 것을 사용한다. 어플리케이션 서버와는 분리된 Cache 서버를 만드는 것이다. 이렇게될 경우 데이터 싱크의 단점이 사라진다. 모두가 하나의 Cache 서버를 바라보기 때문에 동기화 시킬 필요가 없다. 대신에 서버에서 서버로 데이터가 이동되기 때문에 Local Cache 보다는 느리다. 트레이드 오프를 잘 생각해봐야겠지만 사용자가 많은 서비스의 경우에는 Global Cache를 선택하는 것이 유리할 것 같다. 
  
- Web Cache.  
위의 캐시들과 기본적으로 동일한 역할을 한다. 사용자의 첫 요청시에 정적파일(html, css, js, image 등)의 복사본을 특정 위치에 저장하고 같은 URL로 Resource 요청시 server까지 가지 않고 바로 반환해준다. 이러한 캐싱 전략은 많은 이점을 가지고 있다. 일단 빠르다. 그리고 server로부터 소스 다운로드를 따로 받을 필요도 없어 시간 비용이 줄어든다. 또한 server의 입장에서는 처리할 요청이 줄기 때문에 부하를 많이 줄일 수 있다. 다만 데이터는 불변이 아니라는 것을 유념해야한다.  

 캐시에는 몇 가지 종류가 있습니다: 크게 사설(private) 혹은 공유(shared) 캐시 두 가지 부류로 분류될 수 있습니다. 공유 캐시는 한 명 이상의 사용자가 재사용할 수 있도록 응답을 저장하는 캐시를 말합니다. 사설 캐시는 한 명의 사용자만 사용하는 캐시를 말합니다. 브라우저와 프록시 캐시 , 그 외에도 더 나은 신뢰도, 성능 그리고 웹 사이트와 웹 애플리케이션의 확장(scaling)을 위해 웹 서버 위에 배포되는 게이트웨이 캐시, CDN, 리버스 프록시 캐시 그리고 로드 밸랜서 등이 있습니다.   
   
## #3. 어떤 캐시를 언제 사용하는게 적합할까?   
위의 설명에 따라 성능이 중요할 때는 Local Cache, 동시성이 중요할 경우에는 Global Cache(Remote Cache)를 자주 조회되는 정적파일들에 대해서는 web Cache를 사용하면 되겠다. 하지만 어떤 캐시를 선택하던 간에 항상 중요한 것은 본 데이터와의 동시성이다. 또한 캐시를 구현할 때 신중히 고려해야할 부분은 캐시 데이터의 수명이다. 모든 데이터를 지워지지 않고 평생 캐시에 저장해서 사용하는 것은 굉장히 비효울 적이다. 따라서 캐시 만료 정책을 잘 활용하여 오래된 데이터들은 캐시 저장소에서 지워야한다.  
이러한 부분들을 고려하여 사용하면 나머지는 선택의 문제인 것 같다.  

## #3. 캐싱 전략  
5개의 전략이 있다.두개의 읽기전략, 세개의 쓰기 전략  
**1. Cache Aside(읽기에 적합).**  
말그대로 캐시를 옆에 두고 필요할 때만 로딩하는 전략.  
- Cache Miss : 처음 조회할 경우 캐시에 데이터가 존재하지 않다면 데이터베이스에서 해당 요청의 데이터를 조회하고 반환해준다. 그리고 해당 조회 결과를 캐시 저장소에 저장한다.   
- Cache Hit : 캐시에 요청 데이터가 존재하는 경우 해당 데이터를 가져온다.  
DB와 캐시의 데이터가 다를 수 있다. 그래서 동기화를 잘봐야한다. 

**2. Read-Through(읽기에 적합).**  
캐시를 중간에 두고 캐시를 통해 데이터를 캐시에서 조회 하는 전략. 
- Cache Miss : 첫 요청에 대해서는 무조건 Cache Miss가 발생한다. 캐시가 직접 DB에서 데이터를 조회해서 가져오고 App에 반환해준다.    
- Cache Hit : 캐시에 요청 데이터가 존재하는 경우 해당 데이터를 가져온다. 
모든 조회를 캐시를 통해서만 할 수 있기 때문에 캐시와 DB의 데이터가 다를 수 없다.  첫 조회  
  
**3. Write-Through(쓰기에 적합).**  
캐시를 중간에 두고 캐시에 데이터를 저장하고 캐시가 디비에 직접 신규 데이터를 저장하는 전략.  
항상 동기화 되어 캐시의 데이터가 항상 최신 상태이다. 하지만 모든 많이 조회되지 않는 데이터들드 가지고 있게 되어 문제가 발생한다. 이 경우에 캐시 데이터 만료 정책을 잘 설정하여 잘 사용되지 않는 데이터가 삭제될 수 있게 만들어야한다.  
  
**4. Write-Around(쓰기에 적합).**  
DB에 직접 저장하는 전략(이건 그냥 DB 직접 저장 아닌가? 전략이라는 과도한 표현이 필요한가?)  
Cache Miss 데이터만 조회한다.  
여러 읽기전략과 조합이 가능하다.  
  
**5. Write-Back(쓰기에 적합).**  
DB에 쓸 데이터를 먼저 캐시에 저장하고 특정 시점에 DB disk에 flush 시키는 전략 
여러 읽기전략과 조합이 가능하다. 디비에 기록해야하지만 바로 조회되어 보여질 필요성이 적은 데이터에 적합할 것 같다. Message Queue랑 비슷하지 않을까? 
   
   

