# 실시간 알림을 위한 웹소캣 사용하기
토이 프로젝트 진행 중 실시간 알림 기능을 구현하고 싶었다. 그래서 어떤 방법이 있을까 찾아봤다. 웹소캣과 스프링의 @Scheduler를 이용하자는 결론이 났다.  
하지만 사용하고자 하는 기술도 모르고 사용하는게 말이 안된다고 생각했다. 그래서 우선 웹소캣에 대한 개념을 장착해 보자.  
  
  
살짝 논외으 이야기이지만 나는 개념을 잡을때 세가지 키워드를 사용하기로 했다. 해당 개념이 뭐지? 에 대한 대답과 해당 기술을 사용하는 이유에 대한 대답은 무조건 필요하다고 생각했고 다른 기술들도 존재한다면 
왜 이 기술을 사용해야하는지도 추가적으로 생각해 보기로 했다. 나만의 언어로 설명할 수 없으면 이해하지 못한 것이다. 설명이 가능한 정도까지 공부하는게 나의 목적이다.  그럼 시작해보자.   

## #1. 웹소캣이 뭘까? 

> 웹소캣은 기존 HTTP방식 통신의 제약사항을 해결하는 새로운 통신 규약.

무엇일까를 생각하기 전에 왜 웹소캣을 사용하려는 생각까지 다다르게 되었는지부터 이야기하겠다. 클라이언트 서버의 요청을 받는 서버는 기존의 Http방식을 사용했을 때, 클라이언트 서버로부터 요청이 들어오지
않는 한 클라이언트에 어떠한 response도 보낼 수 없었다. Htttp 자체는 stateless한 방식을 사용하기 때문에 무상태성을 유지해야하는 특성을 가지고 있고 이는 Socket의 connection을 
계속해서 유지할 수 없다. 그래서 클라이언트 서버(화면)가 Refresh되지 않는 한 서버의 데이터가 업데이트되더라도 서버에서 클라이언트 서버로 해당 데이터를 업데이트 시켜줄 수 없었다. 이러한 
특성 때문에 서버에서 뉴스기사를 크롤링하여 데이터가 업데이트되더라도 사용자에게 알림을 줄 수 있는 방법이 없었다. 그래서 생각한게 웹 소캣이었다.  

우선 웹소캣의 위의 문제점을 단번에 해결해 준다. 기존의 클라이언트의 요청이 없으면 서버로부터 응답을 받을 수 없는 구조(단방향통신)에서 웹소캣이라는 Protocol(약속)의 등장으로 서버와 브라우저 사이의 
양방향 통신이 가능하게 되었다. 웹소켓이 등장하기 전 단방향 통신의 문제를 다루기 위해 구글에서 Ajax라는 신비로운 기술을 만들어 냈는데 이는 기존의 방식과 세가지 차이가 있었다.  
1. 기존의 통신 방식에서 데이터가 업데이트되면 모든 페이지가 갱신되며 데이터가 업데이트 되었다.  
2. 기존에는 웹브라우저가 직접 서버에 요청을 했다면 ajax방식에서는 xmlhttprequest라는 객체가 서버에 요청한다.
3. 기존에는 페이지를 계속 이동했다면 ajax방식에서는 부분적으로만 변경이 가능해 졌다.  


하지만 여전히 클라이언트 서버의 요청이 없으면 서버는 데이터를 송신할 수 없다.  서버가 클라이언트에게 전송해 주는 푸시(push)방식이 아니라 여전히 클라이언트가 서버에게 요청하는 폴링(polling) 방식이다.  H
HTML5부터 새로운 통신 규약으로 web socket이 나왔다. 그래서 stateful protocol로써 양방향 통신이 가능하게 되었다. 

  
웹소켓은 서비스를 동적으로 만들어 주지만, Ajax, Streaming, Long polling 기술이 더 효과적일 경우도 있다. 예를 들어, 변경 사항의 빈도가 자주 일어나지 않고,  
데이터의 크기가 작은 경우 Ajax, Streaming, Long polling 기술이 더 효과적일 수 있다. 즉, 실시간성을 보장해야 하고, 변경 사항의 빈도가 잦다면, 또는 짧은 대기 시간, 고주파수,  
대용량의 조합인 경우 WebSocket이 좋은 해결책이 될 수 있다.

## #2. 웹소캣은 왜쓰는 걸까?  
기존의 단방향 통신을 양방향 통신으로 하게 하기 위하여 즉, 서버에서 클라이언트로 요청 없이도 응답을 보낼 수 있는 방식이 필요한 기능들을 구현하기 위해서. 
## #3. 웹소캣의 동작 방식  
![image](https://user-images.githubusercontent.com/78134917/168465268-9e3d8c75-3fdb-4f64-9f73-6d4c4d9fd569.png)
별도의 포트를 오픈할 필요 없다. 기본적으로 80, 443 포트를 사용하게 설정 되어있다. 웹소캣은 http로 handShake를 초기 통신을 연결하고 웹소캣 프로토콜로 업그레이드하여 데이터를 전송.  
서버에서 오는 답은 101이다.  
## #3. 어디서 사용되고 있을까?
1. 페이스북과 같은 SNS APP
2. LOL 같은 멀티플레이어 Game
3. 위치 기반 APP
4. 증권 거래 정보 사이트 및 APP
5. 화상 채팅 APP
6. 구글 Doc 같이 여러 명이 동시 접속해서 수정할 수 있는 Tool  

## #4. stomp란? 

https://kukekyakya.tistory.com/12
