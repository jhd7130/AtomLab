## 비밀번호를 저장할때는 plain text로 저장하는 것은 법적 처벌을 받을 수 있다.  
우리는 Encryption을 해야하는 경우가 많다. 위에 이야기한 것 처럼 비밀번호를 저장할 경우가 그 중 하나이다. 로그인 API를 만드는 과정에서 비밀번호를 저장할 때 어떤식으로 저장할 것인가에 대한 고민에 빠졌다. 결론적으로 Spring Security에서 제공하는 bcryptpasswordencoder를 사용했다. 이유는 아래와 같다.  
  
일반적으로 비밀번호를 저장할 때 SHA-256와 같은 단방향 해쉬 함수를 사용하면 안전하다고 생각한다. 하지만 해쉬함수을 통해 반환된 해쉬코드는 인식 가능성이 높다.   
  
>**인식가능성이란?**  
>동일한 메시지가 언제나 동일한 다이제스트를 갖는다면, 공격자가 전처리(pre-computing :: 미리 만들어 놓은 것)된 다이제스트를 가능한 한 많이 확보한 다음 이를 탈취한 다이제스트와 비교해 원본 메시지를 찾아내거나 동일한 효과의 메시지를 찾을 수 있다. 이와 같은 다이제스트 목록을 레인보우 테이블(rainbow table)이라 하고, 이와 같은 공격 방식을 레인보우 공격(rainbow attack)이라 한다. 게다가 다른 사용자의 패스워드가 같으면 다이제스트도 같으므로 한꺼번에 모두 정보가 탈취될 수 있다.  

일반적으로 사용하는 해쉬 함수의 인식 가능성의 문제점은 동일한 메세지는 언제나 동일한 다이제스트를 갖는다는 것이다.   
  
인식 가능성이 높은 것 말고 하나의 문제점이 더 있다. 해쉬함수는 속도가 굉장히 빠르다. 이유는 해쉬함수 자체가 짧은 시간에 데이터를 조회하기 위해 만들어진 함수이기 때문이다. 그럼 이게 왜 문제가 될까?  
해시 함수의 빠른 처리 속도로 인해 공격자는 매우 빠른 속도로 임의의 문자열의 다이제스트와 해킹할 대상의 다이제스트를 비교할 수 있다  
  
우리는 일반적으로 사용하는 해시 함수들을 패스워드 암호화에 사용할 때 안좋은 점 두가지를 알아보았다. 이제 이 두가지에 대한 해결법을 알아보자.  
  
### 솔팅    
솔팅이라는 것으로 동일한 텍스트 입력시 다른 다이제스트가 나오게 만드는 것이다. 쉽게 말하자면 기본 Plain text에 소금을 쳐서 새로운 다이제스트를 만드는 것이다. 같은 텍스트 값을 줘도 솔트가 계속 바뀌면서 
다른 다이제스트를 반환한다. (이 솔팅방식으로 다이제스트를 반환하는 함수가 bycrpt이다. :: 주의! 이 방법을 사용할 때에는 모든 패스워드가 고유의 솔트를 갖고 솔트의 길이는 32바이트 이상이어야 솔트와 다이제스트를 추측하기 어렵다.)  
  
### 키 스트레칭      
해쉬함수의 빠른 연산에 대한 대처로 키 스트레칭을 사용할 수 있다. 말그대로 키 값을 늘리는거다. 어떻게 늘리는가하면 솔트 + 패스워드로 만들어진 다이제스트를 입력값으로 하여 새로운 다이제스트를 만드는 거다. 반복회수 만큼 키는 길어 진다. 이렇게하여 하나의 다이제스트를 기존의 다이제스트로 복원하기 위한 시간을 늘리는 거다.  
  
이 방식을 사용해서 잘 설계된 패스워드 저장 시스템에서는 하나의 다이제스트를 생성할 때 어느 정도(일반적인 장비에서 0.2초 이상)의 시간이 소요되게 설정한다. 이는 억지 기법 공격(brute-force attack)으로 패스워드를 추측하는 데 많은 시간이 소요되도록 하기 위한 것이다.

### Bcrypt. 
아래와 같이 솔트를 얻을때 SecureRandom을 통해서 얻어온다. 그래서 매번 솔트 값이 달라지고 Key Factor를 통해 횟수를 지정하고 키 스트레칭이 가능하다.  
사용하는 쪽에서의 솔트 얻기   
<img width="705" alt="스크린샷 2022-07-04 오후 1 02 55" src="https://user-images.githubusercontent.com/78134917/177079511-dd0646ca-f210-4cde-b476-71a02481be71.png">.  
   
공급에서의 솔트 정의하기   
<img width="908" alt="스크린샷 2022-07-04 오후 1 00 40" src="https://user-images.githubusercontent.com/78134917/177079274-6bcf1c0f-2f72-4188-b145-ade4f18f0609.png">.  


브루트 포스(brute force), 키 전수조사(exhaustive key search) 또는 무차별 대입(無差別代入) : 무지성 대입, 학창 시절 친구의 사물함 비밀번호를 맞추려고 했던 노력이 바로 이거다.
Ref List 
https://d2.naver.com/helloworld/318732
